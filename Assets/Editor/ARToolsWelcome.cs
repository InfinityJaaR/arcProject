using UnityEngine;
using UnityEditor;

/// <summary>
/// Muestra un mensaje de bienvenida cuando se abre Unity
/// </summary>
[InitializeOnLoad]
public class ARToolsWelcome
{
    static ARToolsWelcome()
    {
        // Ejecutar después de que Unity termine de cargar
        EditorApplication.delayCall += ShowWelcomeMessage;
    }

    static void ShowWelcomeMessage()
    {
        // Solo mostrar una vez por sesión
        if (SessionState.GetBool("ARToolsWelcomeShown", false))
            return;

        SessionState.SetBool("ARToolsWelcomeShown", true);

        // Verificar si es la primera vez que se abre después de instalar las herramientas
        bool isFirstTime = !EditorPrefs.GetBool("ARToolsInstalled", false);

        if (isFirstTime)
        {
            EditorPrefs.SetBool("ARToolsInstalled", true);
            ShowFirstTimeMessage();
        }
        else
        {
            // Mensaje corto de recordatorio
            Debug.Log(
                "???????????????????????????????????????????????????\n" +
                "???  AR TOOLS DISPONIBLES\n" +
                "???????????????????????????????????????????????????\n" +
                "Menu: AR Tools > ...\n" +
                "  • Image Tracking Validator\n" +
                "  • Generar Marcador de Prueba\n" +
                "  • Ver Guía de Imágenes\n" +
                "???????????????????????????????????????????????????"
            );
        }
    }

    static void ShowFirstTimeMessage()
    {
        Debug.Log(
            "\n\n" +
            "?????????????????????????????????????????????????????????????????\n" +
            "?                                                               ?\n" +
            "?  ?  HERRAMIENTAS AR INSTALADAS CORRECTAMENTE                ?\n" +
            "?                                                               ?\n" +
            "?????????????????????????????????????????????????????????????????\n" +
            "\n" +
            "?? INSTALACIÓN COMPLETA:\n" +
            "\n" +
            "  ? ImageTrackingValidator.cs       - Validación manual\n" +
            "  ? ARImageBuildValidator.cs         - Validación automática\n" +
            "  ? ARMarkerGenerator.cs              - Generador de marcadores\n" +
            "  ? ARToolsMenu.cs                    - Menu de herramientas\n" +
            "\n" +
            "?? DOCUMENTACIÓN:\n" +
            "\n" +
            "  ? README_SOLUCION.md                - Resumen ejecutivo\n" +
            "  ? SOLUCION_ERROR_KEYPOINTS.md       - Guía detallada\n" +
            "  ? GUIA_IMAGENES_AR.md               - Guía visual\n" +
            "  ? INSTALACION_COMPLETA.md           - Índice completo\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "??  ERROR DETECTADO:\n" +
            "    'Failed to get enough keypoints from target image'\n" +
            "\n" +
            "?? SOLUCIÓN RÁPIDA (3 pasos):\n" +
            "\n" +
            "    1. Menu ? AR Tools ? Generar Marcador de Prueba\n" +
            "       • Nombre: 'biblioteca'\n" +
            "       • Click: 'Generar Marcador'\n" +
            "\n" +
            "    2. Menu ? AR Tools ? Generar Marcador de Prueba\n" +
            "       • Nombre: 'cafeteria'\n" +
            "       • Click: 'Generar Marcador'\n" +
            "\n" +
            "    3. Reemplaza en ReferenceImageLibrary\n" +
            "       • Elimina: biblioteca.png y cafeteria.png antiguas\n" +
            "       • Agrega: Las nuevas desde Generated/\n" +
            "       • Configura: Tamaño físico 0.2 x 0.2 metros\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "?? ACCESO RÁPIDO:\n" +
            "\n" +
            "    Menu: AR Tools ? ...\n" +
            "    ?? ?? Ver Resumen de Solución\n" +
            "    ?? ?? Ver Guía de Imágenes\n" +
            "    ?? ?? Ver Solución Detallada\n" +
            "    ?? ??????????????????????\n" +
            "    ?? Image Tracking Validator\n" +
            "    ?? Generar Marcador de Prueba ?\n" +
            "    ?? Validar Imágenes AR Ahora\n" +
            "    ?? Ayuda Rápida\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "???  PROTECCIÓN AUTOMÁTICA:\n" +
            "\n" +
            "    ? Antes de cada Build Android, el sistema validará\n" +
            "      automáticamente tus imágenes de referencia\n" +
            "    ? Si detecta problemas críticos, te avisará\n" +
            "    ? Podrás cancelar el build y arreglar primero\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "?? GARANTÍA:\n" +
            "\n" +
            "    Los marcadores generados con la herramienta están\n" +
            "    GARANTIZADOS para funcionar correctamente en ARCore.\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "?? MÁS INFORMACIÓN:\n" +
            "\n" +
            "    Lee: Assets/INSTALACION_COMPLETA.md\n" +
            "    O: Menu ? AR Tools ? Ver Resumen de Solución\n" +
            "\n" +
            "???????????????????????????????????????????????????????????????\n" +
            "\n" +
            "?? ¡Listo para usar! Tu próximo build FUNCIONARÁ.\n" +
            "\n\n"
        );

        // Mostrar diálogo también
        bool openDocs = EditorUtility.DisplayDialog(
            "?? Herramientas AR Instaladas",
            "Se han instalado herramientas para solucionar el error:\n" +
            "'Failed to get enough keypoints'\n\n" +
            "SOLUCIÓN RÁPIDA:\n" +
            "1. Menu ? AR Tools ? Generar Marcador de Prueba\n" +
            "2. Crea marcadores para 'biblioteca' y 'cafeteria'\n" +
            "3. Reemplázalos en ReferenceImageLibrary\n\n" +
            "¿Quieres abrir la documentación completa?",
            "Sí, abrir documentación",
            "Ahora no"
        );

        if (openDocs)
        {
            ARToolsMenu.OpenSolutionSummary();
        }
    }
}
